# ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ ìµœì í™” ë°©ë²•ê³¼ ëª¨ë‹ˆí„°ë§ì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸš€ ì ìš©ëœ ìµœì í™”

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”

#### Eager Loading
- `selectinload()`: 1:N ê´€ê³„ì—ì„œ N+1 ì¿¼ë¦¬ ë¬¸ì œ í•´ê²°
- `joinedload()`: 1:1 ê´€ê³„ì—ì„œ JOINì„ í†µí•œ ë‹¨ì¼ ì¿¼ë¦¬ ì‹¤í–‰
- `subqueryload()`: ë³µì¡í•œ ê´€ê³„ì—ì„œ ì„œë¸Œì¿¼ë¦¬ ì‚¬ìš©

```python
# ìµœì í™” ì „
notebooks = db.query(models.Notebook).all()  # N+1 ì¿¼ë¦¬ ë°œìƒ

# ìµœì í™” í›„
notebooks = db.query(models.Notebook).options(
    selectinload(models.Notebook.chapters)
).all()  # ë‹¨ì¼ ì¿¼ë¦¬ë¡œ í•´ê²°
```

#### ì¸ë±ìŠ¤ ìµœì í™”
- ìì£¼ ê²€ìƒ‰ë˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ì¶”ê°€
- ë³µí•© ì¸ë±ìŠ¤ë¡œ ì¿¼ë¦¬ íŒ¨í„´ ìµœì í™”
- Foreign Keyì— ì¸ë±ìŠ¤ ì¶”ê°€

```sql
-- ì¶”ê°€ëœ ì¸ë±ìŠ¤ë“¤
CREATE INDEX idx_notebooks_title ON notebooks(title);
CREATE INDEX idx_notebooks_lastUpdated ON notebooks(lastUpdated);
CREATE INDEX idx_notebook_title_updated ON notebooks(title, lastUpdated);
CREATE INDEX idx_chapter_notebook_order ON chapters(notebook_id, "order");
```

### 2. ìºì‹± ì‹œìŠ¤í…œ

#### LRU ìºì‹œ
- `@lru_cache` ë°ì½”ë ˆì´í„°ë¡œ í•¨ìˆ˜ ê²°ê³¼ ìºì‹±
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œí•œìœ¼ë¡œ ì•ˆì •ì„± í™•ë³´

```python
@lru_cache(maxsize=128)
def get_notebooks_cached(db_id: int) -> List[models.Notebook]:
    # ìºì‹œëœ ê²°ê³¼ ë°˜í™˜
```

#### ìºì‹œ ê´€ë¦¬
- ìºì‹œ í´ë¦¬ì–´ API ì œê³µ
- ìºì‹œ í†µê³„ ëª¨ë‹ˆí„°ë§

### 3. ì¿¼ë¦¬ ìµœì í™” í•¨ìˆ˜

#### ìš”ì•½ ì •ë³´ ì¡°íšŒ
```python
def get_notebook_summary(db: Session, notebook_id: int):
    """ì „ì²´ ë°ì´í„° ë¡œë”© ì—†ì´ ìš”ì•½ ì •ë³´ë§Œ ì¡°íšŒ"""
    
def get_chapters_summary(db: Session, notebook_id: int):
    """ì±•í„° ìš”ì•½ ì •ë³´ë§Œ ì¡°íšŒ"""
```

#### í˜ì´ì§€ë„¤ì´ì…˜
```python
def get_notebooks_with_pagination(db: Session, skip: int = 0, limit: int = 10):
    """ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ë¥¼ ìœ„í•œ í˜ì´ì§€ë„¤ì´ì…˜"""
```

#### ê²€ìƒ‰ ìµœì í™”
```python
def search_notebooks_by_title(db: Session, search_term: str, limit: int = 20):
    """ì¸ë±ìŠ¤ë¥¼ í™œìš©í•œ ë¹ ë¥¸ ê²€ìƒ‰"""
```

### 4. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

#### ì¿¼ë¦¬ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
```python
@monitor_query_performance
def my_database_function(db: Session):
    # ì‹¤í–‰ ì‹œê°„ ìë™ ë¡œê¹…
```

#### ì„±ëŠ¥ ë¶„ì„ ë„êµ¬
- ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ë¶„ì„
- ë°ì´í„°ë² ì´ìŠ¤ í†µê³„ ìˆ˜ì§‘
- ìºì‹œ íˆíŠ¸ìœ¨ ëª¨ë‹ˆí„°ë§

## ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### API ì—”ë“œí¬ì¸íŠ¸

#### ì„±ëŠ¥ í†µê³„ ì¡°íšŒ
```
GET /api/notebooks/admin/performance-stats
```

ì‘ë‹µ ì˜ˆì‹œ:
```json
{
    "database_stats": {
        "notebooks_count": 100,
        "chapters_count": 500,
        "files_count": 1000,
        "contents_count": 500,
        "indexes": ["idx_notebooks_title", "idx_chapter_notebook_order"]
    },
    "cache_info": {
        "notebooks_cache": {
            "hits": 85,
            "misses": 15,
            "maxsize": 128,
            "currsize": 45
        }
    }
}
```

#### ìºì‹œ í´ë¦¬ì–´
```
POST /api/notebooks/cache/clear
```

### ì„±ëŠ¥ ì§€í‘œ

#### ì‘ë‹µ ì‹œê°„ ëª©í‘œ
- ë‹¨ì¼ ë…¸íŠ¸ë¶ ì¡°íšŒ: < 100ms
- ë…¸íŠ¸ë¶ ëª©ë¡ ì¡°íšŒ: < 200ms
- ê²€ìƒ‰ ì¿¼ë¦¬: < 150ms

#### ìºì‹œ íš¨ìœ¨ì„±
- ìºì‹œ íˆíŠ¸ìœ¨: > 80%
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: < 512MB

## ğŸ”§ ìµœì í™” ê¶Œì¥ì‚¬í•­

### 1. ì¿¼ë¦¬ íŒ¨í„´ ë¶„ì„
- ìì£¼ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ íŒ¨í„´ ì‹ë³„
- N+1 ì¿¼ë¦¬ ë¬¸ì œ ëª¨ë‹ˆí„°ë§
- ëŠë¦° ì¿¼ë¦¬ ë¡œê·¸ ë¶„ì„

### 2. ì¸ë±ìŠ¤ ê´€ë¦¬
- ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ì •ê¸° ê²€í† 
- ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¸ë±ìŠ¤ ì œê±°
- ë³µí•© ì¸ë±ìŠ¤ ìµœì í™”

### 3. ìºì‹œ ì „ëµ
- ìºì‹œ ë§Œë£Œ ì •ì±… ì„¤ì •
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
- ìºì‹œ ë¬´íš¨í™” ì „ëµ ìˆ˜ë¦½

### 4. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
- ì •ê¸°ì ì¸ VACUUM ì‹¤í–‰ (SQLite)
- í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸
- ë°ì´í„°ë² ì´ìŠ¤ í¬ê¸° ëª¨ë‹ˆí„°ë§

## ğŸš¨ ì„±ëŠ¥ ë¬¸ì œ í•´ê²°

### ëŠë¦° ì¿¼ë¦¬ ì‹ë³„
1. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë¡œê·¸ í™•ì¸
2. ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ë¶„ì„
3. ì¸ë±ìŠ¤ ì¶”ê°€ ë˜ëŠ” ìµœì í™”

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
1. ìºì‹œ í¬ê¸° ì¡°ì •
2. ë¶ˆí•„ìš”í•œ ë°ì´í„° ë¡œë”© ì œê±°
3. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸

### ì‘ë‹µ ì‹œê°„ ì¦ê°€
1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ í™•ì¸
2. ì¿¼ë¦¬ ìµœì í™”
3. ìºì‹œ íˆíŠ¸ìœ¨ ê°œì„ 

## ğŸ“ˆ í–¥í›„ ê°œì„  ê³„íš

### 1. ê³ ê¸‰ ìºì‹±
- Redis ë„ì… ê²€í† 
- ë¶„ì‚° ìºì‹± ì‹œìŠ¤í…œ
- ìºì‹œ ì›Œë° ì „ëµ

### 2. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
- ì½ê¸° ì „ìš© ë³µì œë³¸ í™œìš©
- íŒŒí‹°ì…”ë‹ ì „ëµ
- ì—°ê²° í’€ ìµœì í™”

### 3. ëª¨ë‹ˆí„°ë§ ê°•í™”
- APM ë„êµ¬ ë„ì…
- ì‹¤ì‹œê°„ ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ
- ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•

## ğŸ› ï¸ ë„êµ¬ ë° ëª…ë ¹ì–´

### ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
```bash
python backend/migrate_add_indexes.py
```

### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
```bash
# ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ
curl -X GET "http://localhost:8000/api/notebooks?limit=100"
```

### ìºì‹œ ìƒíƒœ í™•ì¸
```bash
curl -X GET "http://localhost:8000/api/notebooks/admin/performance-stats"
```

---

ì´ ê°€ì´ë“œëŠ” ì§€ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ë©°, ìƒˆë¡œìš´ ìµœì í™” ê¸°ë²•ì´ ì ìš©ë  ë•Œë§ˆë‹¤ ë¬¸ì„œê°€ ê°±ì‹ ë©ë‹ˆë‹¤.